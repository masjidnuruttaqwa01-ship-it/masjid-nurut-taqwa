<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Display Masjid Nurut Taqwa</title>

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<style>
*{margin:0;padding:0;box-sizing:border-box}
body{
  font-family:Poppins,sans-serif;
  background:linear-gradient(135deg,#064e3b,#065f46,#047857);
  overflow:hidden;
  color:#fff;
}

/* ===== BACKGROUND SLIDESHOW FULL SCREEN ===== */
.slideshow{
  position:fixed;
  inset:0;
  background-size:cover;
  background-position:center;
  background-repeat:no-repeat;
  transition:opacity 1.5s ease;
  z-index:0;
  opacity:0;
  filter:brightness(.5);
}

/* ===== OVERLAY CONTAINER ===== */
.overlay{
  position:fixed;
  inset:0;
  display:flex;
  flex-direction:column;
  z-index:5;
}

/* ===== HEADER PREMIUM HIJAU ===== */
.header{
  height:90px;
  display:flex;
  align-items:center;
  justify-content:space-between;
  padding:0 40px;
  background:rgba(16,185,129,.35);
  backdrop-filter:blur(20px);
  border-bottom:1px solid rgba(255,255,255,.15);
}

.header b{
  font-size:30px;
  font-weight:700;
  color:#fff;
}

.clock{
  font-size:48px;
  font-weight:700;
  color:#fff;
}

/* ===== TANGGAL ===== */
.info{
  text-align:center;
  padding:10px 0;
  font-size:18px;
  background:rgba(6,95,70,.6);
  backdrop-filter:blur(15px);
  border-bottom:1px solid rgba(255,255,255,.1);
}

/* ===== VIDEO AREA ===== */
.video-area{
  flex:1;
  position:relative;
}

.video-area iframe{
  position:absolute;
  inset:0;
  width:100%;
  height:100%;
  border:0;
  z-index:1;
}

/* ===== JADWAL SHOLAT GLASS HIJAU ===== */
.sholat-bottom{
  background:rgba(6,78,59,.85);
  backdrop-filter:blur(20px);
  padding:18px 25px;
}

.sholat-bar{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(110px,1fr));
  gap:14px;
}

.sholat{
  background:linear-gradient(135deg,#0f766e,#115e59);
  border-radius:20px;
  padding:15px 10px;
  text-align:center;
  font-size:16px;
  color:#fff;
  box-shadow:0 8px 25px rgba(0,0,0,.4);
  transition:.3s;
}

.sholat b{
  display:block;
  font-size:24px;
  margin-top:6px;
}

.sholat.active{
  background:linear-gradient(135deg,#facc15,#f59e0b);
  color:#000;
  box-shadow:0 0 30px rgba(250,204,21,.8);
}

/* ===== RUNNING TEXT ===== */
.marquee{
  height:48px;
  display:flex;
  align-items:center;
  background:linear-gradient(90deg,#065f46,#047857);
  overflow:hidden;
}

.marquee span{
  white-space:nowrap;
  padding-left:100%;
  animation:marquee 25s linear infinite;
  font-size:20px;
}

@keyframes marquee{
  from{transform:translateX(0)}
  to{transform:translateX(-100%)}
}

/* ===== VIDEO MODE ===== */
.mode-video .slideshow{opacity:0}
.mode-video iframe{opacity:1}

/* ===== WALLPAPER MODE ===== */
.mode-wallpaper .slideshow{opacity:1}
.mode-wallpaper iframe{opacity:0;pointer-events:none}

/* ===========================
   RESPONSIVE MODE HP
=========================== */
@media (max-width: 900px){

  body{overflow:auto}

  .overlay{position:relative}

  .header{
    height:60px;
    padding:0 16px;
  }

  .header b{font-size:18px}
  .clock{font-size:26px}

  .info{
    font-size:14px;
    padding:4px 0;
  }

  .video-area{
    height:220px;
    flex:none;
  }

  .sholat-bar{
    grid-template-columns:repeat(2,1fr);
    gap:12px;
    padding:10px;
  }

  .sholat{
    padding:12px 6px;
    font-size:13px;
    border-radius:16px;
  }

  .sholat b{font-size:20px}

  .marquee{height:36px}
  .marquee span{font-size:14px}
}
</style>
</head>

<body>

<div class="slideshow" id="slideshow"></div>

<div class="overlay">

<div class="header">
  <b>ðŸ•Œ Masjid Nurut Taqwa</b>
  <div class="clock" id="clock">00:00</div>
</div>

<div class="info">
  <div id="clock"></div>
<div id="masehiDate"></div>
<div id="hijriDate"></div>
</div>

<div class="video-area">
  <iframe 
  width="100%" 
  height="500"
  src="https://www.youtube.com/embed/7-Qf3g-0xEI"
  frameborder="0"
  allowfullscreen>
</iframe>
</div>

<div class="sholat-bottom">
  <div class="sholat-bar" id="sholatBar"></div>
</div>

<div class="marquee">
  <span>Selamat datang di Masjid Nurut Taqwa â€¢ Scan QR untuk donasi â€¢ Ikuti kajian rutin setiap Jumat malam</span>
</div>

</div>

<script>
document.addEventListener("DOMContentLoaded", function () {

  function updateJamTanggal() {
    const now = new Date();

    // ===== JAM =====
    const jam = now.toLocaleTimeString("id-ID", {
      hour: "2-digit",
      minute: "2-digit",
      hour12: false
    });

    const clockEl = document.getElementById("clock");
    if (clockEl) clockEl.innerText = jam;

    // ===== MASEHI =====
    const masehi = now.toLocaleDateString("id-ID", {
      weekday: "long",
      day: "numeric",
      month: "long",
      year: "numeric"
    });

    const masehiEl = document.getElementById("masehiDate");
    if (masehiEl) masehiEl.innerText = masehi;

    // ===== HIJRIYAH (fallback aman) =====
    let hijriText = "";

    try {
      hijriText = new Intl.DateTimeFormat(
        "id-ID-u-ca-islamic",
        { day: "numeric", month: "long", year: "numeric" }
      ).format(now) + " H";
    } catch (e) {
      hijriText = "Tanggal Hijriyah tidak didukung browser";
    }

    const hijriEl = document.getElementById("hijriDate");
    if (hijriEl) hijriEl.innerText = hijriText;
  }

  updateJamTanggal();
  setInterval(updateJamTanggal, 1000);

});
</script>
  <script>
/* ===============================
   JADWAL SHOLAT API
================================ */
fetch("https://api.aladhan.com/v1/timingsByCity?city=Cirebon&country=Indonesia&method=20")
.then(r=>r.json())
.then(res=>{
  const t=res.data.timings;
  const list=[
  ["Imsak",t.Imsak],
  ["Subuh",t.Fajr],
  ["Terbit",t.Sunrise],
  ["Dhuha", tambahMenit(t.Sunrise,20)],
  ["Dzuhur",t.Dhuhr],
  ["Ashar",t.Asr],
  ["Maghrib",t.Maghrib],
  ["Isya",t.Isha]
];
  sholatBar.innerHTML=list.map(s=>`
    <div class="sholat" data-time="${s[1]}">${s[0]}<b>${s[1]}</b></div>
  `).join("");
  function cekWaktu(){
  const now = new Date().toTimeString().slice(0,5);

  document.querySelectorAll(".sholat").forEach(el=>{
    el.classList.remove("active");

    if(el.dataset.time === now){

  el.classList.add("active");

  const nama = el.childNodes[0].textContent.trim().toLowerCase();

  if(nama.includes("terbit") || nama.includes("dhuha")){
    return;
  }

  azanText.style.display="block";
  azanAudio.play();

      let sisa = 600; // 10 menit iqomah
      iqomahText.style.display = "block";

      const timer = setInterval(()=>{
        let m = Math.floor(sisa/60);
        let d = sisa%60;

        iqomahText.innerText =
          `IQOMAH ${m}:${d.toString().padStart(2,"0")}`;

        sisa--;

        if(sisa < 0){
          clearInterval(timer);
          azanText.style.display = "none";
          iqomahText.style.display = "none";
        }
      },1000);
    }
  });
  }
  cekWaktu();
setInterval(cekWaktu,30000);
});
function tambahMenit(waktu, menit){
  let [jam, mnt] = waktu.split(":").map(Number);
  let total = jam * 60 + mnt + menit;
  let h = Math.floor(total / 60) % 24;
  let m = total % 60;
  return h.toString().padStart(2,"0") + ":" + 
         m.toString().padStart(2,"0");
}
    </script>
  <script>
/* ===============================
   SUPABASE WALLPAPER SYSTEM
================================ */
const SUPABASE_URL="https://xntiicnhmhgpujeekmxt.supabase.co";
const SUPABASE_ANON_KEY="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InhudGlpY25obWhncHVqZWVrbXh0Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njg1OTI5MzgsImV4cCI6MjA4NDE2ODkzOH0.JAIAnUgflSHE1oEQ8pKyWk_3F283oh4kiemSumwC-cU";
const sb=supabase.createClient(SUPABASE_URL,SUPABASE_ANON_KEY);

let wallpapers=[];
let index=0;

async function loadWallpapers(){
  const {data}=await sb.storage.from("wallpaper").list("",{limit:100});
  wallpapers=data
    .filter(f=>/\.(jpg|jpeg|png|webp)$/i.test(f.name))
    .map(f=>`${SUPABASE_URL}/storage/v1/object/public/wallpaper/${f.name}`);
  if(wallpapers.length){
    slideshow.style.backgroundImage=`url('${wallpapers[0]}')`;
  }
}

function nextWallpaper(){
  if(!wallpapers.length)return;
  index=(index+1)%wallpapers.length;
  slideshow.style.backgroundImage=`url('${wallpapers[index]}')`;
}
</script>
  <script>
/* ===============================
   MODE VIDEO â†” WALLPAPER
================================ */
function showVideo(){
  document.body.classList.add("mode-video");
  document.body.classList.remove("mode-wallpaper");
  setTimeout(showWallpaper,60000); // 1 menit video
}

function showWallpaper(){
  document.body.classList.add("mode-wallpaper");
  document.body.classList.remove("mode-video");
  setTimeout(showVideo,60000); // 1 menit slideshow
}

loadWallpapers().then(()=>{
  setInterval(nextWallpaper,8000); // ganti 8 detik
  showVideo();
});
</script>
  <script>
/* ===============================
   UNMUTE SEKALI KLIK
================================ */
document.addEventListener("click",()=>{
  const v=document.getElementById("haramainVideo");
  v.src=v.src.replace("mute=1","mute=0");
},{once:true});
</script>
<script>
/* ===== AUTO FULLSCREEN SAAT KLIK ===== */
document.addEventListener("click", function () {

  if (!document.fullscreenElement) {
    document.documentElement.requestFullscreen().catch(err => {
      console.log("Fullscreen gagal:", err);
    });
  }

}, { once: true });
</script>
  <audio id="azanAudio"
src="https://cdn.islamic.network/quran/audio/128/ar.alafasy/1.mp3"
preload="auto"></audio>
  <script>
const azanAudio = document.getElementById("azanAudio");

/* Unlock autoplay supaya tidak perlu klik */
window.addEventListener("load", async () => {
  try {
    azanAudio.muted = true;
    await azanAudio.play();
    azanAudio.pause();
    azanAudio.currentTime = 0;
    azanAudio.muted = false;
    console.log("Audio siap dipakai");
  } catch(e){
    console.log("Autoplay diblok browser");
  }
});
    document.addEventListener("visibilitychange", function () {
  const iframe = document.querySelector("iframe");
  if (!document.hidden) {
    iframe.src = iframe.src; // reload ringan agar lanjut
  }
});
    if ('wakeLock' in navigator) {
  let wakeLock = null;
  const requestWakeLock = async () => {
    try {
      wakeLock = await navigator.wakeLock.request('screen');
    } catch (err) {}
  };
  requestWakeLock();
    }
</script>
</body>
</html>
