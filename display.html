<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Display Masjid Nurut Taqwa</title>

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<style>
*{margin:0;padding:0;box-sizing:border-box}
body{
  font-family:Poppins,sans-serif;
  background:linear-gradient(135deg,#064e3b,#065f46,#047857);
  overflow:hidden;
  color:#fff;
}
  margin:0;
  font-family:'Poppins', sans-serif;
  background-color:#0c4f33;

  background-image:
  url("data:image/svg+xml,%3Csvg width='120' height='120' viewBox='0 0 120 120' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='%23ffffff' fill-opacity='0.05'%3E%3Cpath d='M60 0 L75 30 L105 45 L75 60 L60 90 L45 60 L15 45 L45 30 Z'/%3E%3C/g%3E%3C/svg%3E");

  background-repeat:repeat;
}
/* ===== BACKGROUND SLIDESHOW FULL SCREEN ===== */
.slideshow{
  position:fixed;
  inset:0;
  background-size:cover;
  background-position:center;
  background-repeat:no-repeat;
  transition:opacity 1.5s ease;
  z-index:0;
  opacity:0;
  filter:brightness(.5);
}

/* ===== OVERLAY CONTAINER ===== */
.overlay{
  position:fixed;
  inset:0;
  display:flex;
  flex-direction:column;
  z-index:5;
}

/* ===== HEADER PREMIUM HIJAU ===== */
.header{
  height:90px;
  display:flex;
  align-items:center;
  justify-content:space-between;
  padding:0 40px;
  background:rgba(16,185,129,.35);
  backdrop-filter:blur(20px);
  border-bottom:1px solid rgba(255,255,255,.15);
}

.header b{
  font-size:30px;
  font-weight:700;
  color:#fff;
}

.clock{
  font-size:48px;
  font-weight:700;
  color:#fff;
}

/* ===== TANGGAL ===== */
.info{
  text-align:center;
  padding:10px 0;
  font-size:18px;
  background:rgba(6,95,70,.6);
  backdrop-filter:blur(15px);
  border-bottom:1px solid rgba(255,255,255,.1);
}

/* ===== VIDEO AREA ===== */
.video-area{
  flex:1;
  position:relative;
}

.video-area iframe{
  position:absolute;
  inset:0;
  width:100%;
  height:100%;
  border:0;
  z-index:1;
}

/* ===== JADWAL SHOLAT GLASS HIJAU ===== */
.sholat-bottom{
  background:rgba(6,78,59,.85);
  backdrop-filter:blur(20px);
  padding:18px 25px;
}

.sholat-bar{
  display:grid;
  grid-template-columns:repeat(auto-fit,minmax(110px,1fr));
  gap:14px;
}

.sholat{
  background:linear-gradient(135deg,#0f766e,#115e59);
  border-radius:20px;
  padding:15px 10px;
  text-align:center;
  font-size:16px;
  color:#fff;
  box-shadow:0 8px 25px rgba(0,0,0,.4);
  transition:.3s;
}

.sholat b{
  display:block;
  font-size:24px;
  margin-top:6px;
}

.sholat.active{
  background:linear-gradient(135deg,#facc15,#f59e0b);
  color:#000;
  box-shadow:0 0 30px rgba(250,204,21,.8);
}

/* ===== RUNNING TEXT ===== */
.marquee{
  height:48px;
  display:flex;
  align-items:center;
  background:linear-gradient(90deg,#065f46,#047857);
  overflow:hidden;
}

.marquee span{
  white-space:nowrap;
  padding-left:100%;
  animation:marquee 25s linear infinite;
  font-size:20px;
}

@keyframes marquee{
  from{transform:translateX(0)}
  to{transform:translateX(-100%)}
}

/* ===== VIDEO MODE ===== */
.mode-video .slideshow{opacity:0}
.mode-video iframe{opacity:1}

/* ===== WALLPAPER MODE ===== */
.mode-wallpaper .slideshow{opacity:1}
.mode-wallpaper iframe{opacity:0;pointer-events:none}

/* ===========================
   RESPONSIVE MODE HP
=========================== */
@media (max-width: 900px){

  body{overflow:auto}

  .overlay{position:relative}

  .header{
    height:60px;
    padding:0 16px;
  }

  .header b{font-size:18px}
  .clock{font-size:26px}

  .info{
    font-size:14px;
    padding:4px 0;
  }

  .video-area{
    height:220px;
    flex:none;
  }

  .sholat-bar{
    grid-template-columns:repeat(2,1fr);
    gap:12px;
    padding:10px;
  }

  .sholat{
    padding:12px 6px;
    font-size:13px;
    border-radius:16px;
  }

  .sholat b{font-size:20px}

  .marquee{height:36px}
  .marquee span{font-size:14px}
}
  #soundBtn{
  position:absolute;
  top:15px;
  right:20px;
  background:#facc15;
  color:#000;
  padding:6px 14px;
  border-radius:25px;
  font-size:12px;
  font-weight:600;
  cursor:pointer;
  box-shadow:0 4px 12px rgba(0,0,0,.4);
  z-index:999;
  transition:.3s;
}

#soundBtn:hover{
  transform:scale(1.05);
}
  .tanggal-wrapper {
  display: flex;
  justify-content: center;
  align-items: center;
  gap: 10px;
}

#tapSoundBtn {
  background: #f4c430;
  border: none;
  padding: 5px 10px;
  border-radius: 15px;
  font-size: 12px;
  cursor: pointer;
  box-shadow: 0 2px 5px rgba(0,0,0,0.3);
}

#tapSoundBtn:active {
  transform: scale(0.95);
}
  .header{
  background: linear-gradient(135deg,#0f6b44,#083d28);
  position:relative;
  overflow:hidden;
}

.header::before{
  content:"";
  position:absolute;
  top:0;
  left:0;
  width:100%;
  height:100%;
  background-image:
  url("data:image/svg+xml,%3Csvg width='200' height='200' viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='%23ffffff' fill-opacity='0.03'%3E%3Ccircle cx='100' cy='100' r='80'/%3E%3C/g%3E%3C/svg%3E");
}
 .prayer{
  background:
    linear-gradient(145deg,#0f6b44,#0c4f33);

  border-radius:25px;
  padding:25px;
  color:white;
  position:relative;
  overflow:hidden;

  box-shadow: 0 10px 25px rgba(0,0,0,0.4);
}

.prayer::after{
  content:"";
  position:absolute;
  top:0;
  left:0;
  width:100%;
  height:100%;
  background-image:
  url("data:image/svg+xml,%3Csvg width='100' height='100' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='%23ffffff' fill-opacity='0.04'%3E%3Cpath d='M50 0 L65 25 L100 35 L65 50 L50 85 L35 50 L0 35 L35 25 Z'/%3E%3C/g%3E%3C/svg%3E");
} 
  .prayer{
  border:1px solid rgba(255,215,0,0.2);
}

.header{
  border-bottom:2px solid rgba(255,215,0,0.3);
}
  .ornament-top{
  height:8px;
  background: repeating-linear-gradient(
    45deg,
    #d4af37,
    #d4af37 10px,
    #0c4f33 10px,
    #0c4f33 20px
  );
}
</style>

</head>

<body>
<div class="ornament-top"></div>
<div class="slideshow" id="slideshow"></div>

<div class="overlay">

<div class="header">
  <b>ðŸ•Œ Masjid Nurut Taqwa</b>
  <div class="clock" id="clock">00:00</div>
</div>

<div class="info">
<div class="tanggal-wrapper">
  <div id="hijriDate"></div>
  <button id="tapSoundBtn">ðŸ”Š</button>
</div>

</div>
<div class="video-area">
  <iframe
  id="ytVideo"
  src="https://www.youtube.com/embed/7-Qf3g-0xEI?autoplay=1&mute=1&controls=0&rel=0&loop=1&playlist=7-Qf3g-0xEI"
  allow="autoplay"
  allowfullscreen>
</iframe>
</div>

<div class="sholat-bottom">
  <div class="sholat-bar" id="sholatBar"></div>
</div>

<div class="marquee">
  <span>Selamat datang di Masjid Nurut Taqwa â€¢ Scan QR untuk donasi â€¢ Ikuti kajian rutin setiap Jumat malam</span>
</div>

</div>
<script>
function updateJam() {
  const now = new Date();
  const jam = now.getHours().toString().padStart(2,'0');
  const menit = now.getMinutes().toString().padStart(2,'0');
  document.getElementById("clock").innerText = jam + ":" + menit;
}

updateJam();
setInterval(updateJam,1000);
</script>
  <script>
/* ===============================
   JADWAL SHOLAT API
================================ */
fetch("https://api.aladhan.com/v1/timingsByCity?city=Cirebon&country=Indonesia&method=20")
.then(r=>r.json())
.then(res=>{
  const t=res.data.timings;
  const list=[
  ["Imsak",t.Imsak],
  ["Subuh",t.Fajr],
  ["Terbit",t.Sunrise],
  ["Dhuha", tambahMenit(t.Sunrise,20)],
  ["Dzuhur",t.Dhuhr],
  ["Ashar",t.Asr],
  ["Maghrib",t.Maghrib],
  ["Isya",t.Isha]
];
  sholatBar.innerHTML=list.map(s=>`
    <div class="sholat" data-time="${s[1]}">${s[0]}<b>${s[1]}</b></div>
  `).join("");
  function cekWaktu(){
  const now = new Date().toTimeString().slice(0,5);

  document.querySelectorAll(".sholat").forEach(el=>{
    el.classList.remove("active");

    if(el.dataset.time === now){

  el.classList.add("active");

  const nama = el.childNodes[0].textContent.trim().toLowerCase();

  if(nama.includes("terbit") || nama.includes("dhuha")){
    return;
  }

  azanText.style.display="block";
  azanAudio.play();

      let sisa = 600; // 10 menit iqomah
      iqomahText.style.display = "block";

      const timer = setInterval(()=>{
        let m = Math.floor(sisa/60);
        let d = sisa%60;

        iqomahText.innerText =
          `IQOMAH ${m}:${d.toString().padStart(2,"0")}`;

        sisa--;

        if(sisa < 0){
          clearInterval(timer);
          azanText.style.display = "none";
          iqomahText.style.display = "none";
        }
      },1000);
    }
  });
  }
  cekWaktu();
setInterval(cekWaktu,30000);
});
function tambahMenit(waktu, menit){
  let [jam, mnt] = waktu.split(":").map(Number);
  let total = jam * 60 + mnt + menit;
  let h = Math.floor(total / 60) % 24;
  let m = total % 60;
  return h.toString().padStart(2,"0") + ":" + 
         m.toString().padStart(2,"0");
}
    </script>
<script>
const SUPABASE_URL="https://xntiicnhmhgpujeekmxt.supabase.co";
const SUPABASE_ANON_KEY="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InhudGlpY25obWhncHVqZWVrbXh0Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3Njg1OTI5MzgsImV4cCI6MjA4NDE2ODkzOH0.JAIAnUgflSHE1oEQ8pKyWk_3F283oh4kiemSumwC-cU";
const sb = supabase.createClient(SUPABASE_URL,SUPABASE_ANON_KEY);

let wallpapers=[];
let index=0;
const slideshow = document.getElementById("slideshow");

async function loadWallpapers(){
  try{
    const slideshow = document.getElementById("slideshow");
    const {data,error} = await sb
      .storage
      .from("wallpaper")
      .list();

    if(error){
      console.log("Error load wallpaper:",error);
      return;
    }

    wallpapers = data
      .filter(f=>/\.(jpg|jpeg|png|webp)$/i.test(f.name))
      .map(f=>`${SUPABASE_URL}/storage/v1/object/public/wallpaper/${f.name}`);

    console.log("Wallpaper ditemukan:", wallpapers);

    if(wallpapers.length){
      slideshow.style.backgroundImage = `url('${wallpapers[0]}')`;
      slideshow.style.opacity = "1";
    } else {
      console.log("Tidak ada wallpaper di bucket.");
    }

  }catch(e){
    console.log("Gagal ambil wallpaper",e);
  }
}

function nextWallpaper(){
  if(!wallpapers.length) return;
  index = (index+1) % wallpapers.length;
  slideshow.style.backgroundImage = `url('${wallpapers[index]}')`;
}

loadWallpapers().then(()=>{
  setInterval(nextWallpaper,8000);
});
</script>
<script>
/* ===============================
   MODE VIDEO â†” WALLPAPER (FIXED)
================================ */

function showVideo(){
  document.body.classList.remove("mode-wallpaper");
  document.body.classList.add("mode-video");
}

function showWallpaper(){
  document.body.classList.remove("mode-video");
  document.body.classList.add("mode-wallpaper");
}

// Tunggu wallpaper load dulu
loadWallpapers().then(()=>{
  if(wallpapers.length){
    showWallpaper(); // mulai dari slideshow dulu
    setInterval(nextWallpaper,8000); // ganti tiap 8 detik

    // 1 menit slideshow â†’ pindah video
    setTimeout(()=>{
      showVideo();

      // setelah 1 menit video â†’ balik slideshow lagi
      setInterval(()=>{
        showWallpaper();
        setTimeout(showVideo,60000);
      },120000);

    },60000);
  } else {
    // kalau wallpaper kosong langsung video
    showVideo();
  }
});
</script>
  <script>
/* ===============================
   UNMUTE SEKALI KLIK
================================ */
document.addEventListener("click",()=>{
  const v=document.getElementById("haramainVideo");
  v.src=v.src.replace("mute=1","mute=0");
},{once:true});
</script>
<script>
/* ===== AUTO FULLSCREEN SAAT KLIK ===== */
document.addEventListener("click", function () {

  if (!document.fullscreenElement) {
    document.documentElement.requestFullscreen().catch(err => {
      console.log("Fullscreen gagal:", err);
    });
  }

}, { once: true });
</script>
  <audio id="azanAudio"
src="https://cdn.islamic.network/quran/audio/128/ar.alafasy/1.mp3"
preload="auto"></audio>
  <script>
const azanAudio = document.getElementById("azanAudio");

/* Unlock autoplay supaya tidak perlu klik */
window.addEventListener("load", async () => {
  try {
    azanAudio.muted = true;
    await azanAudio.play();
    azanAudio.pause();
    azanAudio.currentTime = 0;
    azanAudio.muted = false;
    console.log("Audio siap dipakai");
  } catch(e){
    console.log("Autoplay diblok browser");
  }
});
    document.addEventListener("visibilitychange", function () {
  const iframe = document.querySelector("iframe");
  if (!document.hidden) {
    iframe.src = iframe.src; // reload ringan agar lanjut
  }
});
    if ('wakeLock' in navigator) {
  let wakeLock = null;
  const requestWakeLock = async () => {
    try {
      wakeLock = await navigator.wakeLock.request('screen');
    } catch (err) {}
  };
  requestWakeLock();
    }
</script>
  <script>
window.addEventListener("load", function(){

  const iframe = document.getElementById("ytVideo");

  // Tunggu 3 detik
  setTimeout(function(){

    // Kirim perintah unmute ke YouTube Player
    iframe.contentWindow.postMessage(JSON.stringify({
      event: "command",
      func: "unMute",
      args: []
    }), "*");

    iframe.contentWindow.postMessage(JSON.stringify({
      event: "command",
      func: "setVolume",
      args: [100]
    }), "*");

  }, 3000);

});
</script>
 <script>
document.addEventListener("click", function () {
  const iframe = document.getElementById("ytVideo");
  iframe.src = iframe.src.replace("mute=1", "mute=0");
}, { once: true });
</script> 
  <script>
async function updateTanggalHijriyah(){

  const now = new Date();
  const tanggal = now.getDate();
  const bulan = now.getMonth() + 1;
  const tahun = now.getFullYear();

  try {

    const response = await fetch(
      `https://api.aladhan.com/v1/gToH?date=${tanggal}-${bulan}-${tahun}`
    );

    const data = await response.json();

    const hijri = data.data.hijri;

    // Ubah nama bulan ke Indonesia
    const bulanHijriID = {
      "Muharram":"Muharram",
      "Safar":"Safar",
      "Rabi' al-awwal":"Rabiul Awal",
      "Rabi' al-thani":"Rabiul Akhir",
      "Jumada al-awwal":"Jumadil Awal",
      "Jumada al-thani":"Jumadil Akhir",
      "Rajab":"Rajab",
      "Sha'ban":"Sya'ban",
      "Ramadan":"Ramadhan",
      "Shawwal":"Syawal",
      "Dhu al-Qi'dah":"Dzulqa'dah",
      "Dhu al-Hijjah":"Dzulhijjah"
    };

    const bulanFinal = bulanHijriID[hijri.month.en] || hijri.month.en;

    document.getElementById("hijriDate").innerText =
      `${hijri.day} ${bulanFinal} ${hijri.year} H`;

  } catch(e){

    document.getElementById("hijriDate").innerText =
      "Tanggal Hijriyah tidak tersedia";

  }
}

updateTanggalHijriyah();
setInterval(updateTanggalHijriyah, 3600000);
  </script>
</body>
</html>
