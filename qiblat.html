<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Kompas Qiblat</title>

<style>
*{margin:0;padding:0;box-sizing:border-box}
body{
  height:100vh;
  display:flex;
  flex-direction:column;
  justify-content:center;
  align-items:center;
  background:linear-gradient(135deg,#0f9d58,#145374);
  font-family:Poppins, sans-serif;
  color:white;
  text-align:center;
}

h1{
  margin-bottom:20px;
}

#compass{
  width:260px;
  height:260px;
  border:8px solid rgba(255,255,255,.4);
  border-radius:50%;
  position:relative;
  display:flex;
  justify-content:center;
  align-items:center;
  transition:transform .2s linear;
  background:rgba(255,255,255,.1);
  backdrop-filter:blur(10px);
}

#needle{
  width:4px;
  height:110px;
  background:#ffd700;
  position:absolute;
  top:20px;
  border-radius:3px;
}

#kaabaDirection{
  margin-top:25px;
  font-size:18px;
  font-weight:600;
}

button{
  margin-top:25px;
  padding:12px 20px;
  border:none;
  border-radius:25px;
  background:white;
  color:black;
  font-weight:600;
}
</style>
</head>
<body>

<h1>ðŸ§­ Arah Qiblat</h1>

<div id="compass">
  <div id="needle"></div>
</div>

<div id="kaabaDirection">
  Mencari lokasi...
</div>

<button onclick="window.location.href='index.html'">
  â¬… Kembali
</button>

<script>
const KAABA_LAT = 21.4225;
const KAABA_LON = 39.8262;

let userLat, userLon;

/* HITUNG ARAH KA'BAH */
function getQiblaDirection(lat, lon){
  const toRad = deg => deg * Math.PI/180;
  const toDeg = rad => rad * 180/Math.PI;

  const Ï†1 = toRad(lat);
  const Ï†2 = toRad(KAABA_LAT);
  const Î”Î» = toRad(KAABA_LON - lon);

  const y = Math.sin(Î”Î») * Math.cos(Ï†2);
  const x = Math.cos(Ï†1)*Math.sin(Ï†2) -
            Math.sin(Ï†1)*Math.cos(Ï†2)*Math.cos(Î”Î»);

  const Î¸ = Math.atan2(y, x);

  return (toDeg(Î¸) + 360) % 360;
}

/* AMBIL GPS */
navigator.geolocation.getCurrentPosition(pos=>{
  userLat = pos.coords.latitude;
  userLon = pos.coords.longitude;

  const qibla = getQiblaDirection(userLat, userLon);
  document.getElementById("kaabaDirection").innerText =
    "Arah Qiblat: " + Math.round(qibla) + "Â°";

  /* SENSOR KOMPAS */
  window.addEventListener("deviceorientationabsolute", e=>{
    if(e.alpha !== null){
      const heading = e.alpha;
      const rotate = heading - qibla;
      document.getElementById("compass")
        .style.transform = "rotate(" + rotate + "deg)";
    }
  });

}, err=>{
  document.getElementById("kaabaDirection").innerText =
    "Izin lokasi diperlukan";
});
</script>

</body>
</html>
